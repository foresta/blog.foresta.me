+++
title="プログラムはなぜ動くのか？を読んだ"
date="2020-01-25T00:00:00+09:00"
categories = ["engineering"]
tags = ["book", "c", "アセンブラ", "assembler", "compiler", "os", "cpu", "低レイヤー"]
thumbnail = ""
+++

こんにちは、{{< exlink href="https://twitter.com/kz_morita" text="@kz_morita" >}}です。

今回は、プログラムはなぜ動くのかという本を読んだので、その感想を書いていきます。

<a href="https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AF%E3%81%AA%E3%81%9C%E5%8B%95%E3%81%8F%E3%81%AE%E3%81%8B-%E7%AC%AC%EF%BC%92%E7%89%88-%E7%9F%A5%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%8D%E3%81%9F%E3%81%84%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98-%E7%9F%A2%E6%B2%A2%E4%B9%85%E9%9B%84/dp/4822283151/ref=as_li_ss_il?adgrpid=53631245656&gclid=EAIaIQobChMIptvcsIqc5wIVhnZgCh3eFQSBEAAYASAAEgLQkfD_BwE&hvadid=338517958683&hvdev=c&hvlocphy=20636&hvnetw=g&hvpos=1t1&hvqmt=e&hvrand=8820255767653737728&hvtargid=kwd-334563073858&hydadcr=27265_11561134&jp-ad-ap=0&keywords=%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AF%E3%81%AA%E3%81%9C%E5%8B%95%E3%81%8F%E3%81%AE%E3%81%8B&qid=1579863559&sr=8-1&linkCode=li2&tag=foresta04-22&linkId=b727a0f053d1fcbb56c76b4f3004ca73&language=ja_JP" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4822283151&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=foresta04-22&language=ja_JP" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=foresta04-22&language=ja_JP&l=li2&o=9&a=4822283151" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />

{{< exlink href="https://amzn.to/2TT4uw7" text="プログラムはなぜ動くのか 第２版 知っておきたいプログラムの基礎知識" >}}

## 全体的な概要

この本は、普段書いているプログラムが PC 上でどのような原理で動作するのか？といったことが書かれている本になります。

プログラムを `命令` と `データ` にわけ、CPU がどのように命令を解釈するのか？や、データはどうメモリに配置されるのか？などが平易な文章で書かれているので Computer Science にぴったりな本だと思いました。

第 1 章では、プログラムにおける演算や、条件分岐、繰り返しなどがどのように CPU で解釈されるかや、演算に使われるレジスタの紹介などが書かれています。

第 2 章、第 3 章, 第 4 章ではデータをコンピュータ上でどう表現するかが書かれています。データの 2 進数での表現や 2 の補数や、算術演算、論理演算について知ることができます。不動小数点についてもこの章で学ぶことができます。
メモリ上でのデータの表現として、スタック、キュー、ポインタ、リスト、2 分探索木などのデータ構造の紹介もされています。

第 5 章、第 6 章ではメモリとディスクの関係性について書かれています。プログラムが実行時にディスクからメモリにロードされることや、ディスクキャッシュ、仮想メモリ、ページイン、ページアウトなどについても概要を知ることができます。

ディスクについてはその物理構造であるセクタ、クラスタなどの紹介がされています。

また、メモリを節約するという文脈で、Dynamic Link,や Static Link や、データの圧縮法（ランレングス符号化、ハフマン符号化）が簡潔に紹介されています。

第 7 章、第 8 章では、プログラムの動作環境としての、OS とハードウェアや、ソースコードを実行ファイルになるまでのコンパイラや、リンカについて説明がなされています。\
プログラムを実行するために、ディスクからメモリにロードし、変数の領域、関数の領域、スタック領域と、ヒープ領域が確保され、再配置情報から実行時のメモリアドレスが決まることについて書かれています。

第 9 章、第 10 章、第 11 章では、アプリケーションがどのように OS 上で動き、また、ハードウェアを制御したりするかが書かれています。

OS がアプリケーションに API を提供し、ハードウェアが抽象化されていることや、高級言語がどのようにアセンブリコードに変換されるかや、CPU からハードウェアをどのように制御しハードウェアからの割り込み要求を CPU がどう扱うかなどの外観を掴むことができます。

第 12 章では、コンピュータに思考させることについての概要とそれに関連する擬似乱数についてなどが書かれています。

## 感想

まず読み終わってはじめに思ったのは、大学時代に読んでおきたかったなぁというものでした。読んでいて楽しかったです。

本自体は CS を専攻していない方でも読みやすいように工夫されて書かれているという印象を受けました。
書いてある内容としては、二進数やデータの表現方法などから、CPU、レジスタ、メモリ、ディスク、OS などを広く浅く取り扱っていました。

特に自分は、10 章の「アセンブリ言語からプログラムの本当の姿を知る」がとても面白かったです。

その際に手元でいろいろ試して、アセンブリを眺めてたらいろんな知見がありました。
その時のツイートを載せておきます。

{{< tweet 1216629627659014144 >}}

{{< tweet 1216634057116700675 >}}

{{< tweet 1216639772485046272 >}}

{{< tweet 1216644614750294016 >}}

{{< tweet 1216647510313144321 >}}

実際に、簡単な C 言語のソースコードを書いて、アセンブリを表示してみて眺めてたのですが高級言語の演算がアセンブリでどのように表現されているのかいろいろ試しながら確認できたのはとてもよかったです。
普段何気なく動いているアプリケーションの裏側を覗いてみるのは個人的にとても楽しい娯楽で良い体験でした。

低レイヤーへと足を踏み入れる際の第一歩として良さそうなこの本を読み、低レイヤーについてもっと深く知りたいと思ったので、引き続きいろいろ頑張っていこうと思います。
